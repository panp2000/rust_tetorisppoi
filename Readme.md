# テトリス風ゲーム

rustの勉強のために作ったWindowsで動くテトリス風パズルゲームです。断っておきますが相当しょぼいです。動作はWindows11でおこなってます。

## 操作方法

矢印左右キー ブロックの移動
上矢印キー ブロックの回転
下矢印キー ブロック落下

上から落ちてくるブロックを矢印キーで操作してください。横に一列揃えると消えます。上まで積み上がって新しいブロックが出られなくなるとゲームオーバー。

## コードについて

`rust`1.77.2、`SDL2`クレート、乱数発生に`rand`クレート、そして`SDL2`をスタティックリンクするのに`vcpkg`クレートを使用してます。

ビルドするには`SDL2`のライブラリを`vcpkg`経由でインストールし、`x64-windows-static-md`を指定してビルドします。ハードルが高いので動きだけ見たい人は素直に実行ファイルをダウンロードして動かしてください。
以下手順。

1. `vcpkg`を適当な場所にインストール

```bash
git clone https://github.com/microsoft/vcpkg
.\vcpkg\bootstrap-vcpkg.bat

2. ライブラリを`x64-windows-static-md`を指定してビルドする(staticにリンクできるがCのRuntimeはDynamicにリンクする形式の指定)

```bash
vcpkg.exe install sdl2 sdl2-image sdl2-ttf sdl2-mixer sdl2-gfx --triplet x64-windows-static-md
```

3. 環境変数を設定

```msdos
SET VCPKG_ROOT={vcpkgをインストールしたパス}
SET LIB=%VCPKG_ROOT%\installed\x64-windows\lib
SET INCLUDE=%VCPKG_ROOT%\installed\x64-windows\include
```

## 解説

[こちらの動画](https://www.nicovideo.jp/watch/sm8517855 "【プログラミング】テトリスを1時間強で作ってみた【実況解説】")が面白かったのでデータ構造なんかを参考にして組み始めたのですが、元の動画は`C`で`Win32 API`を直叩きのグローバル変数使いまくりで`rust`にはなじまず、細かいところでコードはかなり違ってます。

`rust`に慣れてないのと設計をまともにしなかったせいでコーディングと画像作成に6時間ぐらい、画像ファイルを実行ファイルにバンドルするのにも6時間ぐらい、`SDL2`をスタティックにリンクするのにもう6時間ぐらいかかってます。どれもこれもドキュメントが不親切すぎ…`MSVC`で使うライブラリ形式に2種類あるなんて知らなかったし。おまけに行き当たりばったりでコーディングしてる&コメント少ないので、勉強中の方にはあまり参考にならないと思います。

コンパイラが吐き出すワーニングが消えるようなるべく`rust`っぽい書き方を心がけたので、元の`C`コードに比べるとだいぶ長くなってます。でもおかげさまで一部ロジックがすっきりしました、`rust`コンパイラの指摘は本当優秀。

ライブラリに`SDL2`を使ったのは、最終的に作りたいゲームが低級すぎて最近のすごいゲームエンジンだと作れないっぽいのと、`SDL`は`Windows95`の頃に聞いた記憶があったので今回始めて使ってみました。自分のように空のWindowを表示するのに100行も書きたくないけど、AAAクラスの超リッチなものを作りたいわけではない人にはちょうどいいと思いました。昔のパソコンの感覚で組めるし。

ただし古いライブラリなので、呼び出しはメインスレッドから飲みを想定していたり、`Vulcan`に対応してなかったりしてます。現在`SDL3`が開発中でそちらでは対応させてるようなので、正式版が出たらそちらも使えるように勉強しようと思います。

あとブロックの色はSEGA版に似せてます。回転とかの動きも再現しようと思ったんですけど、勉強の域を超えそうだったのでここまでで一旦終わりにします。

テト◯スはやっても作ってもやっぱり面白い！